"use strict";var verOrcamento={orcData:null,arrayStatus:["Cancelado","Pendente","Aprovado"],acrescimos:0,valorTotal:0,orcStatus:1,orcamento_id:0,nPortas:0,orc_pdf:null,btnVoltar:null,selStatus:null,orc_titulo:null,orc_dataCad:null,orc_valor:null,orc_ascDesc:null,orc_valorTotal:null,orc_numeroPortas:null,orc_largura:null,orc_altura:null,orc_rolo:null,orc_dentroVao:null,orc_cliNome:null,orc_pessoaTipo:null,orc_cliDtCadastro:null,orc_status:null,prodList:null,btnPdf:null,inicializar:function(r){app.securityCheck(),this.btnVoltar=app.E("btnVoltar"),this.selStatus=app.E("selStatus"),this.orcData=r.orcamento,this.orc_titulo=app.E("orc_titulo"),this.orc_dataCad=app.E("orc_data-cad"),this.orc_valor=app.E("orc_valor"),this.orc_ascDesc=app.E("orc_asc-desc"),this.orc_valorTotal=app.E("orc_valor-total"),this.orc_numeroPortas=app.E("orc_numero-portas"),this.orc_largura=app.E("orc_largura"),this.orc_altura=app.E("orc_altura"),this.orc_rolo=app.E("orc_rolo"),this.orc_dentroVao=app.E("orc_dentro-vao"),this.orc_cliNome=app.E("orc_cli-nome"),this.orc_pessoaTipo=app.E("orc_pessoa-tipo"),this.orc_cliDtCadastro=app.E("orc_cli-dt-cadastro"),this.prodList=app.E("prodList"),this.btnPdf=app.E("btnPdf"),verOrcamento.orcamento_id=r.id,new Api("orcamentos/abrir",{orcamento_id:r.id}).send(function(r){r.error?app.Erro(r):r?verOrcamento.preencheDados(r):(new Mensagem("Ocorreu um erro e o orçamento não foi encontrado",!0),app.abrirPag("meusOrcamentos"))}),this.btnVoltar.addEventListener("click",app.onBackButtonClick),this.btnPdf.addEventListener("click",this.orcGeraPDFClick),this.selStatus.addEventListener("change",this.selStatusChange)},preencheDados:function(r){var o=this;o.orc_titulo.innerHTML="ORÇAMENTO "+r.orcamento.id,o.orc_dataCad.innerHTML=app.formataData(r.orcamento.dt_cadastro,!0),o.orc_valor.innerHTML="R$ "+r.orcamento.valor_total,o.orc_ascDesc.innerHTML=0,o.orc_valorTotal.innerHTML=0,o.orc_numeroPortas.innerHTML=r.orcamento.portas,o.orc_largura.innerHTML=r.orcamento.largura,o.orc_altura.innerHTML=r.orcamento.altura,o.orc_rolo.innerHTML=r.orcamento.largura<8.5?.6:.9,o.orc_dentroVao.innerHTML="Dentro do Vão"==r.orcamento.is_dentro_vao?"Sim":"Não",o.orc_cliNome.innerHTML=r.orcamento.cli_nome+" "+r.orcamento.cli_snome,o.orc_pessoaTipo.innerHTML="F"==r.orcamento.cli_tipo?"Pessoa Física":"Pessoa Jurídica",o.orc_cliDtCadastro.innerHTML=app.formataData(r.orcamento.cli_cadastro,!0),$(o.selStatus).val(r.orcamento.status),o.mudaCorStatus(),o.orc_pdf=r.orcamento.pdf,o.orc_status=r.orcamento.status,o.nPortas=r.orcamento.portas,o.valorTotal=r.orcamento.valor_total,o.getProdutos(r.produtos)},orcGeraPDFClick:function(){var r;0<verOrcamento.orcamento_id&&(verOrcamento.orc_pdf?(r="orcamento"+verOrcamento.orcamento_id+".pdf",geraOrcamentoPDF(verOrcamento.orcamento_id,r,!1,!0)):(r="orcamento"+verOrcamento.orcamento_id+".pdf",geraOrcamentoPDF(verOrcamento.orcamento_id,r,!1,!1,function(r,o){new Api("orcamentos/upPdf?oid="+verOrcamento.orcamento_id,{arquivo:r}).send(function(r){r.error?app.Erro(r):(new Mensagem("PDF do orçamento atualizado",!0),verOrcamento.orc_pdf=r,verOrcamento.orcGeraPDFClick())})})))},getProdutos:function(r){var o=Object.keys(r).length;if(o){for(var a=0;a<o;a++)verOrcamento.prodList.appendChild(verOrcamento.geraProdutos(r[a]));verOrcamento.orc_ascDesc.innerHTML="R$ "+app.N(verOrcamento.acrescimos,2,","),verOrcamento.orc_valorTotal.innerHTML="R$ "+app.N(app.C(verOrcamento.valorTotal,"+",verOrcamento.acrescimos),2,",")}else{new Mensagem("Erro no recebimento dos dados",!0);app.abrirPag("meusOrcamentos")}},geraProdutos:function(r){var o=app.CE("div",{class:"produto listagem"}),a=app.CE("div",{class:"item"}),t=app.CE("img",{src:"./img/loader.gif"}),e=app.CE("div",{class:"item"}),n=app.CE("div",{class:"item"}),c=app.CE("div",{class:"item"});return app.getImgFromApi(r.imagem,function(r){var o;r?(t.src=r,o=ImageViewer(),$(t).on("tap click",function(){o.show(this.src,this.src)})):t.src="img/nenhum.png"}),e.innerHTML=r.quantidade||verOrcamento.nPortas+".00",n.innerHTML=r.nome,c.innerHTML=r.preco_unitario+" ("+r.acrescimo+"%)",verOrcamento.acrescimos=app.C(app.N(verOrcamento.acrescimos,2,"."),"+",app.N(r.preco_unitario*(r.acrescimo/100),2,".")),console.log(verOrcamento.acrescimos),a.appendChild(t),o.appendChild(a),o.appendChild(e),o.appendChild(n),o.appendChild(c),o},alteraStatusEmail:function(a,t,r){var e=!0;2==t?verOrcamento.orc_pdf?geraOrcamentoPDF(a,"orcamento"+a+".pdf",!1,!1,function(r,o){new Api("orcamentos/enviarEmail?oid="+a+"&altStatus=1",{pdf:verOrcamento.orc_pdf}).send(function(r){r.error?(e=!1,app.Erro(r),$("#selStatus").val(verOrcamento.orc_status),verOrcamento.mudaCorStatus()):(new Mensagem("Status alterado e E-mail com pdf enviado ao vendedor!",!0),e=verOrcamento.alteraStatus(a,t))})}):new Mensagem("Não foi possível enviar o arquivo PDF por email pois o mesmo não foi encontrado em nosso servidor",!0):e=verOrcamento.alteraStatus(a,t),r(e)},alteraStatus:function(r,o){var a;new Api("orcamentos/abrir",{orcamento_id:r,status:o}).send(function(r){return r.error?(new Mensagem(r.error,!0),$("#selStatus").val(verOrcamento.orcStatus),a=!1):1==r.AltStatus?(2!=o&&new Mensagem(r.msg,!0),a=!0,verOrcamento.orcStatus=o,a):(new Mensagem(r.msg,!0),$("#selStatus").val(verOrcamento.orc_status),a=!1)})},selStatusChange:function(){var r;2!=verOrcamento.orc_status?(verOrcamento.orcStatus=$("#selStatus").val(),(r=new Mensagem("Deseja alterar o status do orçamento para: "+verOrcamento.arrayStatus[$("#selStatus").val()])).setTipo("confirma"),r.setBotoes(["Sim","Não"]),r.mostrar(function(r){1==r?verOrcamento.altera():verOrcamento.selStatus.value=verOrcamento.orc_status})):(r=new Mensagem("Não é possível alterar o status do orçamento após ele ter sido aprovado",!0),verOrcamento.selStatus.value=verOrcamento.orc_status)},altera:function(){Loader.mostrar(),verOrcamento.alteraStatusEmail(verOrcamento.orcamento_id,verOrcamento.orcStatus,function(r){0==r&&$("#selStatus").val(verOrcamento.orcStatus),verOrcamento.mudaCorStatus(),Loader.remover()})},mudaCorStatus:function(){var r=$("#selStatus").val(),o=document.getElementById("selStatus");o.style.backgroundColor=0==r?"#f72f2f":2==r?"#8cff6f":"#d2d2d2",o.style.color="black"}};