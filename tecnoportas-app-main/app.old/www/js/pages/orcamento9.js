"use strict";var orcamento9={origem:null,dados:null,prods:null,valores:{},tmpValores:{},acrescimos:{},incrementos:{opcionais:{}},quantidades:{},listaProds:null,vlTotal:0,tmpVlTotal:0,orcamento_id:null,valor_total:null,tmpDados:null,margemSelecionada:0,enviado:!1,calculado:!1,nivelModal:0,vlTeste:0,isFromCarrinho:null,navFinal:null,botaoOverlay:null,btTroca:null,btMargem:null,btExcluir:null,btQtd:null,btVlr:null,btHome:null,btNovo:null,btnEnvia:null,btnVoltar:null,btnsFinal:null,divModal:null,btVoltarProd:null,listaTrocaItem:null,listaTrocaMargem:null,listaExcluirSim:null,listaExcluirNao:null,listaInputQtd:null,listaInputVlr:null,btnQtdOk:null,btnVlrOk:null,tblProds:null,selecMargem:null,btSalvarPdf:null,btCompartPdf:null,switchLucro:!1,pdf_aberto:!1,inicializar:function(a){app.securityCheck(),0<this.nivelModal&&this.removeModal(),this.tblProds=app.E("tblProds"),this.criaModal(),document.getElementById("loader-final").classList.remove("is-loaded"),a?this.tmpDados=a:(o=new VarGlobal("informacoesGlobaisDeOrcamento"),this.tmpDados=o.obterLocal(),this.tmpDados=JSON.parse(this.tmpDados));var o=new VarGlobal("incrementos"),o=(o.obterLocal()&&(this.incrementos=o.obterLocal(),this.incrementos=JSON.parse(this.incrementos)),new VarGlobal("acrescimos")),o=(o.obterLocal()&&(this.acrescimos=o.obterLocal(),this.acrescimos=JSON.parse(this.acrescimos)),new VarGlobal("margemSelecionada"));if(o.obterLocal()&&(this.margemSelecionada=o.obterLocal(),this.margemSelecionada=JSON.parse(this.margemSelecionada)),this.btTroca=app.E("btTroca"),this.btMargem=app.E("btMargem"),this.btExcluir=app.E("btExcluir"),this.btQtd=app.E("btQtd"),this.btVlr=app.E("btVlr"),this.btHome=app.E("btHome"),this.btNovo=app.E("btNovo"),this.listaProds=app.E("listaProds"),this.btnEnvia=app.E("btnEnvia"),this.btnVoltar=app.E("btnlVoltar"),this.valor_total=app.E("valor_total"),this.btnsFinal=app.E("btnsFinal"),this.divModal=app.E("divModal"),this.btVoltarProd=app.E("btVoltarProd"),this.listaTrocaItem=app.E("listaTrocaItem"),this.listaTrocaMargem=app.E("listaTrocaMargem"),this.listaExcluirSim=app.E("listaExcluirSim"),this.listaExcluirNao=app.E("listaExcluirNao"),this.listaInputQtd=app.E("listaInputQtd"),this.listaInputVlr=app.E("listaInputVlr"),this.btnQtdOk=app.E("btnQtdOk"),this.btnVlrOk=app.E("btnVlrOk"),this.navFinal=app.E("navFinal"),this.selecMargem=app.E("selecMargem"),this.btSalvarPdf=app.E("btSalvarPdf"),this.btCompartPdf=app.E("btCompartPdf"),this.botaoOverlay=app.E("botaoOverlay"),this.btTroca.addEventListener("click",this.btTrocaClick),this.btMargem.addEventListener("click",this.btMargemClick),this.btQtd.addEventListener("click",this.btQtdClick),this.btExcluir.addEventListener("click",this.btExcluirClick),this.btVlr.addEventListener("click",this.btVlrClick),this.btHome.addEventListener("click",this.btHomeClick),this.btNovo.addEventListener("click",this.btNovoClick),this.btnEnvia.addEventListener("click",this.geraOrc),this.btVoltarProd.addEventListener("click",this.fechaModalClick),this.btnVoltar.addEventListener("click",app.onBackButtonClick),this.btSalvarPdf.addEventListener("click",this.GeraPDFClick),this.btCompartPdf.addEventListener("click",this.btCompartOrcClick),this.botaoOverlay.addEventListener("click",function(){$(".modal").removeClass("is-active"),$(".list-options").addClass("-is-active"),$(".list-trocaItem").removeClass("-is-active"),$(".list-excluir").removeClass("-is-active"),$(".list-trocaMargem").removeClass("-is-active"),$(".box-search").removeClass("-is-active"),$(".list-quantidade").removeClass("-is-active"),$(".list-valor").removeClass("-is-active")}),a&&(this.origem=a.origem,this.dados=a.dados),this.origem){if("carrinho"==this.origem){if(app.E("btnEnvia").style.display="none",app.E(".row")[0].style.display="none",a){this.prods=a.dados.dados;var t,e={};for(t in this.prods)e[this.prods[t].id]=this.prods[t];console.log(e),this.prods=e}else this.prods=this.isFromCarrinho;this.isFromCarrinho=this.prods,this.setProdutosCarrinho()}}else this.calcFinal(),this.setaMargemGeral();for(this.busca();"0.00"==this.valor_total||this.valor_total<=0;)console.log("while"),this.checaBtFinal();var i=document.querySelector("#divApp > section > div > form > div > div.total");orcamento9.switchLucro||(i.addEventListener("click",function(){i.classList.contains("is-active")?i.classList.remove("is-active"):(i.classList.add("is-active"),document.getElementsByClassName("pequeno")?orcamento9.alterDescontValue():orcamento9.insertDescont())}),orcamento9.switchLucro=!0)},criaModal:function(){this.nivelModal++;var a=app.CE("div",{id:"modalId"});a.innerHTML='<div id="divModal" class="modal"><div class="heading-opcao"><button id="btVoltarProd" class="voltar"> <svg class="icon"><use xlink:href="icon.svg#icon-chevron-left"></use></svg></button><div class="opcao"><h2 id="modalProdNome" class="nome">Nome produto</h2></div></div><div class="box-search"><input id="inputSearch" class="input-default" type="search" name="" placeholder="Buscar" ><svg class="icon"><use xlink:href="icon.svg#icon-search"></use></svg></div><ul class="list-options -is-active"><li class="option" id="btTroca"><svg class="icon"><use xlink:href="icon.svg#icon-exchange"></use></svg><span class="nome">Trocar item</span></li><li class="option" id="btQtd"><svg class="icon"><use xlink:href="icon.svg#icon-plus"></use></svg><span class="nome">Quantidade</span></li><li class="option" id="btVlr"><svg class="icon"><use xlink:href="icon.svg#icon-money"></use></svg><span class="nome">Inserir Valor</span></li><li class="option" id="btMargem"><svg class="icon"><use xlink:href="icon.svg#icon-percent"></use></svg><span class="nome">margem</span></li><li class="option" id="btExcluir"><svg class="icon deletar"><use xlink:href="icon.svg#icon-trash-o"></use></svg><span class="nome deletar">Excluir item</span></li></ul><ul id="listaTrocaItem" class="list-trocaItem"><li class="option"><span class="nome">Motor tm ac 600</span></li><li class="option"><span class="nome">teste</span></li><li class="option"><span class="nome">Motor tm ac 600</span></li><li class="option"><span class="nome">Motor tm ac 600</span></li></ul><ul id="listaTrocaMargem" class="list-trocaMargem"><li class="option"><span class="nome">+ 25%</span></li><li class="option"><span class="nome">+ 20%</span></li><li class="option"><span class="nome">+ 15%</span></li><li class="option"> <span class="nome">+ 10%</span></li><li class="option"><span class="nome">+ 5%</span></li><li class="option"><span class="nome"> 0</span></li><li class="option"><span class="nome">- 5%</span></li><li class="option"> <span class="nome">- 10%</span></li><li class="option"><span class="nome">- 15%</span></li><li class="option"> <span class="nome">- 20%</span></li><li class="option"><span class="nome">- 25%</span></li></ul><ul class="list-excluir"><li id="listaExcluirSim" class="option">Sim</li><li id="listaExcluirNao" class="option">NÃ£o</li></ul><ul class="list-quantidade"><span class="nome">Quantidade: </span><input id="listaInputQtd" class="input-default" type="number" name="" placeholder="UN" ></ul><ul class="list-quantidade"><button type="button" class="btn btn-default" id="btnQtdOk">OK</button></ul><ul class="list-valor"><span class="nome">Adicione Valor: </span><input id="listaInputVlr" class="input-default" type="number" name="" placeholder="0"></ul><ul class="list-valor"><button type="button" class="btn btn-default" id="btnVlrOk">OK</button></ul></div><div class="overlay" id="botaoOverlay"></div>',this.tblProds.appendChild(a)},removeModal:function(){app.E("modalId").parentNode.removeChild(app.E("modalId"))},geraOrc:function(){var a,o,t;orcamento9.origem&&"carrinho"==orcamento9.origem?t={serralheiro_id:app.thisUser[0].pessoa_id,cliente_id:orcamento9.dados.cliDados.id,orc:{opcionais:JSON.stringify(orcamento9.prods),valor_total:orcamento9.vlTotal,valores:JSON.stringify(orcamento9.valores),quantidades:JSON.stringify(orcamento9.quantidades),acrescimos:JSON.stringify(orcamento9.acrescimos)}}:(o="",(a=new VarGlobal("version")).obterLocal()&&(o=a.obterLocal()),t={serralheiro_id:app.thisUser[0].pessoa_id,cliente_id:orcamento9.tmpDados.cliDds.id,orc:{portas:orcamento9.tmpDados.quantidadeDePortas,altura:orcamento9.tmpDados.fnAltura,largura:orcamento9.tmpDados.largura,tpi:orcamento9.tmpDados.tipoDeInstalacao,perfil:orcamento9.tmpDados.perfilDds?orcamento9.tmpDados.perfilDds.id:null,motor:orcamento9.tmpDados.motorDds?orcamento9.tmpDados.motorDds.id:null,testeira:orcamento9.tmpDados.testeiraDds?orcamento9.tmpDados.testeiraDds.id:null,automatizador:orcamento9.tmpDados.automatizador_id,entrada:orcamento9.tmpDados.entradaDds?orcamento9.tmpDados.entradaDds.id:null,pintura:orcamento9.tmpDados.pintura,fita:orcamento9.tmpDados.fitaDds?orcamento9.tmpDados.fitaDds.id:null,opcionais:JSON.stringify(orcamento9.tmpDados.opcionais),valor_total:orcamento9.tmpVlTotal,valores:JSON.stringify(orcamento9.valores),quantidades:JSON.stringify(orcamento9.quantidades),acrescimos:JSON.stringify(orcamento9.acrescimos)},appVer:o},console.log(t)),new Api("orcamentos/novo",t).send(function(a){var o,t,e,i;a.error?app.Erro(a):(new VarGlobal("informacoesGlobaisDeOrcamento").salvarLocal(null),o=new VarGlobal("acrescimos"),t=new VarGlobal("incrementos"),e=new VarGlobal("margemSelecionada"),o.salvarLocal(null),t.salvarLocal(null),e.salvarLocal(null),new VarGlobal("carrinho").salvarLocal(null),orcamento9.orcamento_id=a.orcamento_data.id,i="orcamento"+orcamento9.orcamento_id+".pdf",geraOrcamentoPDF(orcamento9.orcamento_id,i,!1,!1,function(a,o){new Api("orcamentos/upPdf?oid="+orcamento9.orcamento_id,{arquivo:a}).send(function(a){var o=a;a.error?app.Erro(a):(document.querySelector("#divModal2").classList.add("is-active"),document.querySelector("#listaExcluirSimo9").addEventListener("click",function(){orcamento9.pdf_aberto||(geraOrcamentoPDF(orcamento9.orcamento_id,i),orcamento9.pdf_aberto=!0,orcamento9.enviaEmail(orcamento9.orcamento_id,o))}),document.querySelector("#listaExcluirNaoo9").addEventListener("click",function(){orcamento9.pdf_aberto=!0,orcamento9.enviaEmail(orcamento9.orcamento_id,o)}))})}))})},enviaEmail:function(a,o){document.querySelector("#modalProdNomeO9").innerHTML="Enviar PDF",document.querySelector("#pzinho").innerHTML="Deseja enviar um email com o arquivo PDF para o cliente ?",document.querySelector("#opcaoo9").insertAdjacentHTML("beforeend","");var e=document.querySelector("#divModal2");e.classList.add("is-active"),document.querySelector("#listaExcluirSimo9").addEventListener("click",function(){new Api("orcamentos/enviarEmail?oid="+a,{pdf:o}).send(function(a){a.error?app.Erro(a):((a=new Mensagem("Seu orÃ§amento foi gerado e enviado para seu cliente por e-mail. Obrigado por orÃ§ar conosco!")).setTitulo("OrÃ§amento realizado com Sucesso!"),a.mostrar(function(){orcamento9.enviado=!0,orcamento9.btnsFinal.style.display="none",orcamento9.navFinal.style.display="block";new VarGlobal("informacoesGlobaisDeOrcamento").salvarLocal(null);var a=new VarGlobal("acrescimos"),o=new VarGlobal("incrementos"),t=new VarGlobal("margemSelecionada");a.salvarLocal(null),o.salvarLocal(null),t.salvarLocal(null),new VarGlobal("carrinho").salvarLocal(null)}))}),e.classList.remove("is-active")}),document.querySelector("#listaExcluirNaoo9").addEventListener("click",function(){orcamento9.enviado=!0,orcamento9.btnsFinal.style.display="none",orcamento9.navFinal.style.display="block";new VarGlobal("informacoesGlobaisDeOrcamento").salvarLocal(null);var a=new VarGlobal("acrescimos"),o=new VarGlobal("incrementos"),t=new VarGlobal("margemSelecionada");a.salvarLocal(null),o.salvarLocal(null),t.salvarLocal(null),new VarGlobal("carrinho").salvarLocal(null),e.classList.remove("is-active")})},calcFinal:function(){app.E("btnEnvia").style.display="none",Loader.mostrar();var v=this;v.vlTotal=0,v.tmpVlTotal=0,v.acrescimos||(v.acrescimos={}),v.quantidades||(v.quantidades={}),v.orcamento_id=0,new Api("portoes/componentes",{is_padrao:"1"}).send(function(a){if(!a.error){console.log(v.calculado),o=v.calculado?orcamento9.tmpDados.opcionais:a,v.listaProds.innerHTML="",v.tmpDados.porm2=app.C(v.tmpDados.fnAltura,"*",app.N(v.tmpDados.largura),3);var o,t,e,i=v.tmpDados.quantidadeDePortas,s=app.N(v.tmpDados.largura),r=v.tmpDados.fnAltura,n=v.tmpDados.porm2,a=v.tmpDados.perfilDds,l=v.tmpDados.motorDds,c=v.tmpDados.testeiraDds,d=v.tmpDados.fitaDds,p=v.tmpDados.tipoDeInstalacao;if(v.quantidades.perfil=v.quantidades.perfil||app.C(n,"*",i),v.tmpDados.perfilDds&&(v.quantidades.perfil?v.valores.perfil=app.C(a.valor_unitario,"*",v.quantidades.perfil,2):v.valores.perfil=app.C(a.valor_unitario,"*",n,2),t=v.valores.perfil,v.acrescimos.perfil?(e=t*(v.acrescimos.perfil/100),v.tmpValores.perfil=app.C(t,"+",e,2)):v.tmpValores.perfil=t,Loader.mostrar(),v.listaProds.appendChild(v.geraProdutosOrcamento("perfil",v.quantidades.perfil,a,v.valores.perfil,v.tmpValores.perfil))),v.tmpDados.motorDds&&(v.quantidades.motor?v.valores.motor=app.C(l.valor_unitario,"*",v.quantidades.motor,2):v.valores.motor=app.C(l.valor_unitario,"*",i,2),v.quantidades.motor=v.quantidades.motor||i,t=v.valores.motor,v.acrescimos.motor?(e=t*(v.acrescimos.motor/100),v.tmpValores.motor=app.C(t,"+",e,2)):v.tmpValores.motor=t,Loader.mostrar(),v.listaProds.appendChild(v.geraProdutosOrcamento("motor",v.quantidades.motor,l,v.valores.motor,v.tmpValores.motor))),v.tmpDados.testeiraDds&&(v.quantidades.testeira?v.valores.testeira=app.C(c.valor_unitario,"*",v.quantidades.testeira,2):v.valores.testeira=app.C(c.valor_unitario,"*",i,2),v.quantidades.testeira=v.quantidades.testeira||i,a=v.valores.testeira,v.acrescimos.testeira?(e=a*(v.acrescimos.testeira/100),v.tmpValores.testeira=app.C(a,"+",e,2)):v.tmpValores.testeira=a,Loader.mostrar(),v.listaProds.appendChild(v.geraProdutosOrcamento("testeira",v.quantidades.testeira,c,v.valores.testeira,v.tmpValores.testeira))),v.tmpDados.fitaDds&&(v.quantidades.fita?v.valores.fita=app.C(d.valor_unitario,"*",v.quantidades.fita,2):v.valores.fita=app.C(d.valor_unitario,"*",i,2),v.quantidades.fita=v.quantidades.fita||i,t=v.valores.fita,v.acrescimos.fita?(e=t*(v.acrescimos.fita/100),v.tmpValores.fita=app.C(t,"+",e,2)):v.tmpValores.fita=t,Loader.mostrar(),v.listaProds.appendChild(v.geraProdutosOrcamento("fita",v.quantidades.fita,d,v.valores.fita,v.tmpValores.fita))),0<v.tmpDados.automatizador_id&&0<(l=v.tmpDados.autDds).id&&(v.quantidades.automatizador?v.valores.automatizador=app.C(l.valor_unitario,"*",v.quantidades.automatizador,2):v.valores.automatizador=app.C(l.valor_unitario,"*",i,2),v.quantidades.automatizador=v.quantidades.automatizador||i,a=v.valores.automatizador,v.acrescimos.automatizador?(e=a*(v.acrescimos.automatizador/100),v.tmpValores.automatizador=app.C(a,"+",e,2)):v.tmpValores.automatizador=a,Loader.mostrar(),v.listaProds.appendChild(v.geraProdutosOrcamento("automatizador",v.quantidades.automatizador,l,v.valores.automatizador,v.tmpValores.automatizador))),v.tmpDados.entradas&&0<v.tmpDados.entradas.entrada_id&&(c=v.tmpDados.entradaDds,v.quantidades.entrada?v.valores.entrada=app.C(c.valor_unitario,"*",v.quantidades.entrada,2):v.valores.entrada=app.C(c.valor_unitario,"*",i,2),v.quantidades.entrada=v.quantidades.entrada||i,t=v.valores.entrada,console.log("entradaVl:"+t),v.acrescimos.entrada?(e=t*(v.acrescimos.entrada/100),console.log("entradaVl:"+e),v.tmpValores.entrada=app.C(t,"+",e,2)):v.tmpValores.entrada=t,Loader.mostrar(),v.listaProds.appendChild(v.geraProdutosOrcamento("entrada",v.quantidades.entrada,c,v.valores.entrada,v.tmpValores.entrada))),0<v.tmpDados.pintura&&0<(d=v.tmpDados.pinturaDds).id&&(v.quantidades.pintura?v.valores.pintura=app.C(d.valor_unitario,"*",v.quantidades.pintura,2):v.valores.pintura=app.C(d.valor_unitario,"*",app.C(n,"*",i),2),v.quantidades.pintura=v.quantidades.pintura||app.C(n,"*",i),a=v.valores.pintura,v.acrescimos.pintura?(e=a*(v.acrescimos.pintura/100),v.tmpValores.pintura=app.C(a,"+",e,2)):v.tmpValores.pintura=a,Loader.mostrar(),v.listaProds.appendChild(v.geraProdutosOrcamento("pintura",v.quantidades.pintura,d,v.valores.pintura,v.tmpValores.pintura))),0<o.length){for(var m in o){var u=v.calcForumlasProd(o[m],s,r,i,n,v.tmpDados.peso_total,p,"condicao");(0<u||u===o[m].condicao)&&(o[m].tipo=!1,o[m].remove=!1,v.tmpDados.opcionais[o[m].id]=o[m])}v.calculado=!0}Loader.mostrar(),v.geraProdutoOrcamentoOpcional(v.tmpDados.opcionais,s,r,i,n,v.tmpDados.peso_total,p),0==$(".item-orc").length?(v.valor_total="0.00",v.btnEnvia.style.display="none"):(v.btnEnvia.style.display="flex",document.getElementById("loader-final").classList.add("is-loaded")),console.log("final func"),orcamento9.insertDescont()}})},checaBtFinal:function(){"0.00"==self.valor_total?(Loader.mostrar(),app.E("btnEnvia").style.display="none"):(Loader.remover(),app.E("btnEnvia").style.display="flex",document.getElementById("loader-final").classList.add("is-loaded"))},setProdutosCarrinho:function(){this.listaProds.innerHTML="",this.vlTotal=0,this.prods?(this.geraProdutoOrcamentoOpcional(this.prods),app.E("valor_total").innerHTML=orcamento9.vlTotal):this.listaProds.innerHTML="<h3>Nenhum produto encontrado</h3>",0==$(".item-orc").length&&(self.valor_total="0.00",self.btnEnvia.style.display="none"),app.E("btnEnvia").style.display="flex",document.getElementById("loader-final").classList.add("is-loaded")},geraProdutosOrcamento:function(a,o,t,e,i){i=i||e,t.medida||t.unidade_medida&&(t.medida=t.unidade_medida);var s,r,n,l,c,d,p,m=this;return"Un"!=t.medida&&"PAR"!=t.medida&&"PC"!=t.unidade&&"RL"!=t.medida||(o=Math.ceil(o)),isNaN(a)||null!=m.quantidades.opcionais&&(m.quantidades.opcionais[t.id]=o,e=app.C(o,"*",e,2),i=app.C(o,"*",i,2),m.valores.opcionais[t.id]=e,m.tmpValores.opcionais[t.id]=i,m.acrescimos.opcionais[t.id]&&(c=e*(m.acrescimos.opcionais[t.id]/100),i=app.C(e,"+",c),m.tmpValores.opcionais[t.id]=i)),c=app.CE("div",{id:"prod"+t.id,class:"item item-orc"}),s=app.CE("img",{src:"./img/loader.gif",alt:t.nome}),m=app.CE("div",{class:"nome"}),r=app.CE("div",{class:"tipo"}),n=app.CE("div",{class:"preco"}),(l=app.CE("div",{id:"editar"})).innerHTML="<svg class='icon'><use xlink:href='icon.svg#icon-ellipsis-v'></use></svg>",orcamento9.vlTotal=(parseFloat(orcamento9.vlTotal)+parseFloat(i)).toFixed(2),orcamento9.tmpVlTotal=(parseFloat(orcamento9.tmpVlTotal)+parseFloat(e)).toFixed(2),null!=t.imagem?app.getImgFromApi(t.imagem,function(a){s.src=a}):null!=t.img?app.getImgFromApi(t.img,function(a){s.src=a}):s.src="./img/nenhum.png",e=i||e,console.log(e),m.innerHTML=t.nome,r.innerHTML=app.N(o,2)+"<br/>("+t.medida+")",n.innerHTML="R$ "+e.toFixed(2),d=t,p=a,c.addEventListener("click",function(){0==orcamento9.enviado&&(orcamento9.divModal.classList.add("is-active"),app.E("modalProdNome").innerHTML=d.nome,orcamento9.setaComponentesModal(p,d))}),c.appendChild(s),c.appendChild(m),c.appendChild(r),c.appendChild(n),c.appendChild(l),orcamento9.valor_total.innerHTML="R$ "+orcamento9.vlTotal,c},geraProdutoOrcamentoOpcional:function(a,o,t,e,i,s,r){e||(i=e=t=o=1);var n=this;if(0<Object.keys(a).length){n.valores.opcionais||(n.valores.opcionais={},n.tmpValores.opcionais={}),n.acrescimos.opcionais||(n.acrescimos.opcionais={});var l,c=[];for(l in a)console.log(a[l]),"0"!=a[l].is_rodape&&a[l].is_rodape?c.push(a[l]):(d=n.calcForumlasProd(a[l],o,t,e,i,n.tmpDados.peso_total,r),p=0,d=(d*=e)||e,p=app.N(a[l].valor_unitario),null==n.quantidades.opcionais&&(n.quantidades.opcionais={}),n.quantidades.opcionais[l]||(a[l].quantidade?n.quantidades.opcionais[l]=a[l].quantidade:n.quantidades.opcionais[l]=d),n.valores.opcionais[l]=p,n.tmpValores.opcionais[l]=p,n.incrementos.opcionais[l]&&(n.valores.opcionais[l]+=n.incrementos.opcionais[l],n.tmpValores.opcionais[l]+=n.incrementos.opcionais[l]),void 0===a[l].tipo&&0,console.log("Quantidade:"),console.log(n.quantidades.opcionais[l]),n.listaProds.appendChild(n.geraProdutosOrcamento(l,n.quantidades.opcionais[l],a[l],n.valores.opcionais[l])));for(l in c){var d=n.calcForumlasProd(c[l],o,t,e,i,n.tmpDados.peso_total,r),p=0;d=(d*=e)||e,p=app.N(a[c[l].id].valor_unitario),null==n.quantidades.opcionais&&(n.quantidades.opcionais={}),n.quantidades.opcionais[c[l].id]||(a[c[l].id].quantidade?n.quantidades.opcionais[c[l].id]=a[c[l].id].quantidade:n.quantidades.opcionais[c[l].id]=d),n.valores.opcionais[c[l].id]=p,n.tmpValores.opcionais[c[l].id]=p,n.incrementos.opcionais[c[l].id]&&(n.valores.opcionais[c[l].id]+=n.incrementos.opcionais[c[l].id],n.tmpValores.opcionais[c[l].id]+=n.incrementos.opcionais[c[l].id]),void 0===c[l].tipo&&0,n.listaProds.appendChild(n.geraProdutosOrcamento(c[l].id,n.quantidades.opcionais[c[l].id],c[l],n.valores.opcionais[c[l].id]))}orcamento9.valor_total.innerHTML="R$ "+orcamento9.vlTotal}},geraProdutosCarrinho:function(a){var o,t=app.CE("div",{class:"list-table",id:"prod"+a.id}),e=app.CE("img",{src:"./img/loader.gif",alt:a.nome,class:"w-100"}),i=app.CE("div",{class:"nome"}),s=app.CE("div",{class:"tipo"}),r=app.CE("div",{class:"preco"}),n=app.CE("div",{id:"divLixo"});return n.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' class='icon w-100 mg -bm-md' viewBox='0 0 24 28'><path fill='white' d='M8 11.5v9c0 0.281-0.219 0.5-0.5 0.5h-1c-0.281 0-0.5-0.219-0.5-0.5v-9c0-0.281 0.219-0.5 0.5-0.5h1c0.281 0 0.5 0.219 0.5 0.5zM12 11.5v9c0 0.281-0.219 0.5-0.5 0.5h-1c-0.281 0-0.5-0.219-0.5-0.5v-9c0-0.281 0.219-0.5 0.5-0.5h1c0.281 0 0.5 0.219 0.5 0.5zM16 11.5v9c0 0.281-0.219 0.5-0.5 0.5h-1c-0.281 0-0.5-0.219-0.5-0.5v-9c0-0.281 0.219-0.5 0.5-0.5h1c0.281 0 0.5 0.219 0.5 0.5zM18 22.813v-14.812h-14v14.812c0 0.75 0.422 1.188 0.5 1.188h13c0.078 0 0.5-0.438 0.5-1.188zM7.5 6h7l-0.75-1.828c-0.047-0.063-0.187-0.156-0.266-0.172h-4.953c-0.094 0.016-0.219 0.109-0.266 0.172zM22 6.5v1c0 0.281-0.219 0.5-0.5 0.5h-1.5v14.812c0 1.719-1.125 3.187-2.5 3.187h-13c-1.375 0-2.5-1.406-2.5-3.125v-14.875h-1.5c-0.281 0-0.5-0.219-0.5-0.5v-1c0-0.281 0.219-0.5 0.5-0.5h4.828l1.094-2.609c0.313-0.766 1.25-1.391 2.078-1.391h5c0.828 0 1.766 0.625 2.078 1.391l1.094 2.609h4.828c0.281 0 0.5 0.219 0.5 0.5z' style='width: 25px;height: 25px;'></path></svg>",orcamento9.vlTotal=(parseFloat(orcamento9.vlTotal)+parseFloat(a.valor_unitario)*parseInt(a.quantidade)).toFixed(2),null!=a.img?app.getImgFromApi(a.img,function(a){e.src=a}):e.src="./img/nenhum.png",i.innerHTML=a.nome,s.innerHTML=a.quantidade+"<br/>("+a.unidade_medida+")",r.innerHTML="R$ "+a.valor_unitario,o=a,n.addEventListener("click",function(){orcamento9.removeCart(o.id,o.nome)}),t.appendChild(e),t.appendChild(i),t.appendChild(s),t.appendChild(r),t.appendChild(n),t},calcForumlasProd:function(a,o,t,e,i,s,r,n){n=a[n||"formula"];return n&&(o={ATT:this.tmpDados.altura,LGP:o,ATP:t,PTP:e,PM2:i,PKG:s,PRF:this.tmpDados.perfilID,MAT:this.tmpDados.materialID,TPI:this.tmpDados.tipoDeInstalacao,VL:a.valor_unitario},new CalcFormula(n,o).calcula())},setaComponentesModal:function(t,e){for(var i=this,a=(i.btTroca.style.display="flex",i.btVlr.style.display="flex",0<e.valor_unitario&&(i.btVlr.style.display="none"),"motor"==t?(a=new Api("motores",null,!0,!0),i.listaInputQtd.value=i.quantidades.motor):"testeira"==t?(a=new Api("motores/testeiras",null,!0,!0),i.listaInputQtd.value=i.quantidades.testeira):"fita"==t?(a=new Api("portoes/fitaPVC",null,!0,!0),i.listaInputQtd.value=i.quantidades.fita):"automatizador"==t?(a=new Api("motores/automatizadores",null,!0,!0),i.listaInputQtd.value=i.quantidades.automatizador):"entrada"==t?(a=new Api("portoes/entradas",null,!0,!0),i.listaInputQtd.value=i.quantidades.entrada):"pintura"==t?(a=new Api("portoes/pinturas",null,!0,!0),i.listaInputQtd.value=i.quantidades.pintura):"perfil"==t?(i.btTroca.style.display="none",i.listaInputQtd.value=i.quantidades.perfil):(t="opcional",i.listaInputQtd.value=i.quantidades.opcionais[e.id],a=new Api("portoes/componentes",null,!0,!0)),a&&a.send(function(a){if(i.listaTrocaItem.innerHTML="",a.error)app.Erro(a);else if(0<a.length)for(var o=0;o<a.length;o++)i.listaTrocaItem.appendChild(i.geraComponenteModal(a[o],e,t))}),i.listaTrocaMargem.innerHTML="",app.thisUser[0].acrecimo_max),o=parseInt(a);0<o;o-=5){var s=app.CE("li",{class:"option"});(n=app.CE("span",{class:"nome"})).innerHTML=o+"%",s.appendChild(n),!function(o){s.addEventListener("click",function(){orcamento9.salvarParaGlobal(orcamento9.tmpDados);var a=new VarGlobal("acrescimos");"motor"==t?orcamento9.acrescimos.motor=o:"testeira"==t?orcamento9.acrescimos.testeira=o:"fita"==t?orcamento9.acrescimos.fita=o:"automatizador"==t?orcamento9.acrescimos.automatizador=o:"entrada"==t?orcamento9.acrescimos.entrada=o:"pintura"==t?orcamento9.acrescimos.pintura=o:"perfil"==t?orcamento9.acrescimos.perfil=o:orcamento9.acrescimos.opcionais[e.id]=o,a.salvarLocal(JSON.stringify(orcamento9.acrescimos)),orcamento9.inicializar()})}(o),i.listaTrocaMargem.appendChild(s)}var s=app.CE("li",{class:"option"}),r=((n=app.CE("span",{class:"nome"})).innerHTML="0%",s.appendChild(n),s.addEventListener("click",function(){orcamento9.salvarParaGlobal(orcamento9.tmpDados);var a=new VarGlobal("acrescimos");"motor"==t?i.acrescimos.motor=0:"testeira"==t?i.acrescimos.testeira=0:"fita"==t?i.acrescimos.fita=0:"automatizador"==t?i.acrescimos.automatizador=0:"entrada"==t?i.acrescimos.entrada=0:"pintura"==t?i.acrescimos.pintura=0:"perfil"==t?i.acrescimos.perfil=0:i.acrescimos.opcionais[e.id]=0,a.salvarLocal(JSON.stringify(orcamento9.acrescimos)),i.inicializar()}),i.listaTrocaMargem.appendChild(s),app.thisUser[0].desconto_max);if(1==app.thisUser[0].desconto_seletivo)switch(t){case"motor":r=app.thisUser[0].desconto_mto;break;case"testeira":r=app.thisUser[0].desconto_tst;break;case"fita":r=app.thisUser[0].desconto_opc;break;case"automatizador":r=app.thisUser[0].desconto_aut;break;case"entrada":r=app.thisUser[0].desconto_ent;break;case"pintura":r=app.thisUser[0].desconto_ptr;break;case"perfil":r=app.thisUser[0].desconto_prf;break;default:r=app.thisUser[0].desconto_opc}for(o=5;o<=r;o+=5){var n,s=app.CE("li",{class:"option"});(n=app.CE("span",{class:"nome"})).innerHTML="-"+o+"%",s.appendChild(n),!function(o){s.addEventListener("click",function(){var a=new VarGlobal("acrescimos");orcamento9.salvarParaGlobal(orcamento9.tmpDados),"motor"==t?orcamento9.acrescimos.motor=-1*o:"testeira"==t?orcamento9.acrescimos.testeira=-1*o:"fita"==t?orcamento9.acrescimos.fita=-1*o:"automatizador"==t?orcamento9.acrescimos.automatizador=-1*o:"entrada"==t?orcamento9.acrescimos.entrada=-1*o:"pintura"==t?orcamento9.acrescimos.pintura=-1*o:"perfil"==t?orcamento9.acrescimos.perfil=-1*o:orcamento9.acrescimos.opcionais[e.id]=-1*o,a.salvarLocal(JSON.stringify(orcamento9.acrescimos)),orcamento9.inicializar()})}(o),i.listaTrocaMargem.appendChild(s)}i.listaExcluirSim.addEventListener("click",function(){i.removeProd(t,e)}),i.listaExcluirNao.addEventListener("click",function(){i.fechaModalClick()});i.btnQtdOk.addEventListener("click",function(){i.setaQtd(t,i.listaInputQtd.value,e.id)}),i.btnVlrOk.addEventListener("click",function(){i.incrementaVlr(t,i.listaInputVlr.value,e.id)})},removeProd:function(a,o){var t=this;"motor"==a?(delete t.tmpDados.motorDds,delete t.valores.motor,delete t.quantidades.motor):"testeira"==a?(delete t.tmpDados.testeiraDds,delete t.valores.testeira,delete t.quantidades.testeira):"fita"==a?(delete t.tmpDados.fitaDds,delete t.valores.fita,delete t.quantidades.fita):"automatizador"==a?(delete t.tmpDados.automatizador_id,delete t.tmpDados.autDds,delete t.valores.automatizador,delete t.quantidades.automatizador):"entrada"==a?(delete t.tmpDados.entradaDds,delete t.tmpDados.entradas,delete t.valores.entrada,delete t.quantidades.entrada):"pintura"==a?(delete t.tmpDados.pintura,delete t.tmpDados.pinturaDds,delete t.valores.pintura,delete t.quantidades.pintura):"perfil"==a?(delete t.tmpDados.perfil,delete t.tmpDados.perfilDds,delete t.tmpDados.perfilID,delete t.valores.perfil,delete t.quantidades.perfil):(t.tmpDados.opcionais?delete t.tmpDados.opcionais[o.id]:delete t.prods[o.id],delete t.valores.opcionais[o.id],delete t.quantidades.opcionais[o.id]),orcamento9.salvarParaGlobal(orcamento9.tmpDados),t.fechaModalClick(),t.inicializar()},setaQtd:function(a,o,t){var e=this;"opcional"!=a?"perfil"==a?e.quantidades.perfil=o:e.quantidades[a]=o:(e.quantidades.opcionais[t]=o,console.log(e.quantidades.opcionais[t]),console.log(e.quantidades.opcionais)),orcamento9.salvarParaGlobal(orcamento9.tmpDados),e.fechaModalClick(),e.inicializar()},setaMargemGeral:function(){for(var a=app.thisUser[0].acrecimo_max,o=app.thisUser[0].desconto_max,t=[],e=(1==app.thisUser[0].desconto_seletivo&&(t.push(parseInt(app.thisUser[0].desconto_aut)),t.push(parseInt(app.thisUser[0].desconto_ent)),t.push(parseInt(app.thisUser[0].desconto_mto)),t.push(parseInt(app.thisUser[0].desconto_opc)),t.push(parseInt(app.thisUser[0].desconto_prf)),t.push(parseInt(app.thisUser[0].desconto_ptr)),t.push(parseInt(app.thisUser[0].desconto_tst)),console.log(t),t.sort(function(a,o){return a-o}),console.log(t),o=t[0]),app.CE("select",{class:"select-desc"})),i=parseInt(a);0<i;i-=5)(s=app.CE("option")).innerHTML=i+"%",s.value=i,e.appendChild(s);(s=app.CE("option",{selected:"selected"})).innerHTML="0%",s.value=0,e.appendChild(s);for(var s,i=5;i<=o;i+=5)(s=app.CE("option")).innerHTML="-"+i+"%",s.value=-1*i,e.appendChild(s);e.addEventListener("change",function(){var a,o=$(e).val();for(a in console.log("change"),console.log(o),orcamento9.acrescimos.motor=o,orcamento9.acrescimos.testeira=o,orcamento9.acrescimos.fita=o,orcamento9.acrescimos.automatizador=o,orcamento9.acrescimos.entrada=o,orcamento9.acrescimos.pintura=o,orcamento9.acrescimos.perfil=o,orcamento9.valores.opcionais)orcamento9.acrescimos.opcionais[a]=100==a||552==a?0:o;orcamento9.margemSelecionada=o;var t=new VarGlobal("acrescimos");new VarGlobal("margemSelecionada").salvarLocal(orcamento9.margemSelecionada),t.salvarLocal(JSON.stringify(orcamento9.acrescimos)),orcamento9.salvarParaGlobal(orcamento9.tmpDados),orcamento9.inicializar()}),0!=orcamento9.margemSelecionada&&$(e).val(orcamento9.margemSelecionada),self.selecMargem.innerHTML="",self.selecMargem.appendChild(e)},incrementaVlr:function(a,o,t){orcamento9.incrementos.opcionais[t]=o,new VarGlobal("incrementos").salvarLocal(JSON.stringify(orcamento9.incrementos)),orcamento9.salvarParaGlobal(orcamento9.tmpDados),orcamento9.inicializar()},geraComponenteModal:function(a,o,t){var e,i,s,r=app.CE("li",{class:"option"}),n=app.CE("span",{class:"nome"});return n.innerHTML=a.nome,e=a,i=o,s=t,r.addEventListener("click",function(){"motor"==s?orcamento9.tmpDados.motorDds=e:"testeira"==s?orcamento9.tmpDados.testeiraDds=e:"fita"==s?orcamento9.tmpDados.fitaDds=e:"automatizador"==s?orcamento9.tmpDados.autDds=e:"entrada"==s?orcamento9.tmpDados.entradaDds=e:"pintura"==s?(orcamento9.tmpDados.pintura=e.id,orcamento9.tmpDados.pinturaDds=e):(console.log(i),orcamento9.tmpDados.opcionais?(delete orcamento9.tmpDados.opcionais[i.id],orcamento9.tmpDados.opcionais[e.id]=e):(delete orcamento9.prods[i.id],orcamento9.prods[e.id]=e)),console.log("TROCOU POR: "+e.nome),orcamento9.salvarParaGlobal(orcamento9.tmpDados),orcamento9.fechaModalClick(),orcamento9.inicializar()}),r.appendChild(n),r},salvarParaGlobal:function(a){new VarGlobal("informacoesGlobaisDeOrcamento").salvarLocal(JSON.stringify(a))},btTrocaClick:function(){$(".list-options").removeClass("-is-active"),$(".list-trocaItem").addClass("-is-active"),$(".box-search").addClass("-is-active")},btMargemClick:function(){$(".list-options").removeClass("-is-active"),$(".list-trocaMargem").addClass("-is-active")},btExcluirClick:function(){$(".list-options").removeClass("-is-active"),$(".list-excluir").addClass("-is-active")},btQtdClick:function(){$(".list-options").removeClass("-is-active"),$(".list-quantidade").addClass("-is-active")},btVlrClick:function(){$(".list-options").removeClass("-is-active"),$(".list-valor").addClass("-is-active")},btHomeClick:function(){"home"!=app.thisPage().id&&app.abrirPag("home")},btNovoClick:function(){"orcamento1"!=app.thisPage().id&&app.abrirPag("orcamento1")},fechaModalClick:function(a){a&&a.preventDefault(),console.log($(".list-options").hasClass("-is-active")),$(".list-options").hasClass("-is-active")?$(".modal").removeClass("is-active"):$(".list-options").addClass("-is-active"),$(".list-trocaItem").removeClass("-is-active"),$(".list-excluir").removeClass("-is-active"),$(".list-trocaMargem").removeClass("-is-active"),$(".box-search").removeClass("-is-active"),$(".list-quantidade").removeClass("-is-active"),$(".list-valor").removeClass("-is-active")},busca:function(){$(inputSearch).on("keyup",function(){var a=$(this).val().toLowerCase();$(".list-trocaItem .option").filter(function(){$(this).toggle(-1<$(this).text().toLowerCase().indexOf(a))})})},isEmptyObj:function(a){for(var o in a)if(a.hasOwnProperty(o))return!1;return!0},GeraPDFClick:function(){var a="orcamento"+orcamento9.orcamento_id+".pdf";geraOrcamentoPDF(orcamento9.orcamento_id,a)},btCompartOrcClick:function(){var a="orcamento"+orcamento9.orcamento_id+".pdf";geraOrcamentoPDF(orcamento9.orcamento_id,a,!0,!1)},insertDescont:function(){document.querySelector("#divApp > section > div > form > div > div.total").insertAdjacentHTML("beforeend",'<div class="pequeno"></div>'),orcamento9.alterDescontValue()},alterDescontValue:function(){var a=app.thisUser[0].desconto_max,o=null!=orcamento9.incrementos.opcionais[100]?orcamento9.incrementos.opcionais[100]:0,t=null!=orcamento9.incrementos.opcionais[552]?orcamento9.incrementos.opcionais[552]:0,e=(o=parseFloat(o),t=parseFloat(t),orcamento9.tmpVlTotal),e=parseFloat(e),i=orcamento9.vlTotal,i=parseFloat(i),s=orcamento9.margemSelecionada,e=e-(o+t);parseInt(s);s=e-a/100*e,a=parseFloat(i-(o+t)-s),e=o+t,i=a+e;document.getElementsByClassName("pequeno")[0].innerHTML="<span>Custo do Material: R$ "+s.toFixed(2)+"</span><span>Lucro no Material: R$ "+a.toFixed(2)+"</span><span>Ganhos MÃ£o de Obra: R$ "+e.toFixed(2)+"</span><span>Lucro Total: R$ "+i.toFixed(2)+"</span>"}};