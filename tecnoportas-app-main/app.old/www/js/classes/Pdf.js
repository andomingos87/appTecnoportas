"use strict";function geraOrcamentoPDF(e,w,o,r,p){function t(t){app.isFile(P+w,function(a){var C;a&&0!=r?N():(C=t,new Api("orcamentos/geraPDF",{orcamento_id:e}).send(function(a){if(a.error)app.Erro(a);else{var e=a.orcamento_data,t=a.produtos,o=new Date,r=new Date(e.dt_cadastro.replace(/\s/,"T")),p=0;o.setDate(r.getDate()+30);for(var i=(i=app.thisUser[0].tel_num)?(i=i.substring(i.length-4),"("+app.thisUser[0].ddd+") "+app.thisUser[0].tel_num.replace(i,"")+"-"+i):"",s="J"==e.cli_tipo?"CNPJ":"CPF",d="J"==e.cli_tipo?"IE":"RG",n={documentSize:"A4",type:"base64"},l=[],c=0;c<t.length;c++){var u,m,_,h=t[c],g=l.length+1,f=h.nome;switch(h.tipo){case"mto":u=h.mto_id,f="Motor "+h.nome;break;case"aut":u=h.aut_id;break;case"ptr":u=h.ptr_id,f="Pintura "+h.nome;break;default:u=h.id}_=0<=app.N(h.acrescimo)?"+":"-",m=0==app.N(h.preco_unitario)?app.C(h.preco_unitario,"+",h.acrescimo):app.C(app.C(h.preco_unitario,"*",app.C(h.acrescimo,"/",100)),_,h.preco_unitario),"-"==_&&(m*=-1),_=app.C(m,"/",h.quantidade),p=app.C(m,"+",p),l.push([g,h.codigo||u,f,h.medida,h.quantidade,app.N(_,2,","),app.N(m,2,",")])}var v={thead:{var:"colunas_tabela",dados:["Item","Código","Discrição das Mercadorias","Und","Qtd","Unitário","Total"]},tbody:{var:"dados_tabela",dados:l}},b=app.N(e.altura*e.largura,2,"."),U=app.N(e.largura)<8.5?.6:.9,D=app.N(app.C(e.altura,"-",U),3,".");new Api("ajustes/gerais").send(function(a){console.log(a);var t=null,a=(a.error?app.Erro(a):t=a.nome_empresa,{orcamento_id:e.id,orcamento_data:app.formataData(r,!0),validade_orc:app.formataData(o),prev_entrega:app.formataData(o),logo_src:C||cordova.file.applicationDirectory+"www/images/centro.png",nome_fantasia:"J"==app.thisUser[0].tipo?app.thisUser[0].sobrenome:app.thisUser[0].nome,razao_social:"J"==app.thisUser[0].tipo?app.thisUser[0].nome:app.thisUser[0].nome+" "+app.thisUser[0].sobrenome,texto_cnpj:!app.thisUser[0].cnpj||"J"==app.thisUser[0].tipo?"CNPJ:":"CPF:",cnpj:app.thisUser[0].cnpj||"08.944.971/0001-00",texto_ie:app.thisUser[0].ie?"J"==app.thisUser[0].tipo?"IE:":"RG:":"",ie:app.thisUser[0].ie||"",email:app.thisUser[0].email,end_logradouro:app.thisUser[0].logradouro,end_numero:app.thisUser[0].numero,end_bairro:app.thisUser[0].bairro,end_cep:app.thisUser[0].cep,end_cidade:app.thisUser[0].cidade,end_uf:app.thisUser[0].uf,end_tel:i,cli_nome:"J"==e.cli_tipo?e.cli_nome:e.cli_nome+" "+e.cli_snome,cli_tel:"("+e.telefone_ddd+") "+e.telefone_num,cli_cidade:e.cidade,cli_uf:e.estado,cli_email:e.email,td_endereco:null==e.logradouro?"<td>&nbsp</td><td colspan='3'></td>":"<td class='text-right'>Endere&ccedil;o:</td><td colspan='3'>"+e.logradouro+"</td>",td_cel:null==e.celular?"<td></td><td></td>":"<td class='text-right'>Celular:</td><td>"+e.celular+"</td>",td_bairro:null==e.bairro?"<td class='text-right'>Cidade:</td><td class='text-uppercase'>"+e.cidade+" - "+e.estado+"</td><td></td><td></td>":"<td class='text-right'>Bairro:</td><td>"+e.bairro+"</td>",td_numImovel:null==e.num?"<td colspan='2'></td>":"  <td class='text-right'>N&uacute;mero Im&oacute;vel:</td><td>"+e.numero+"</td>",td_cep:null==e.cep?"<td colspan='2'></td>":"<td class='text-right'>CEP:</td><td>"+e.cep+"</td>",td_cpfRg:null==e.cpf?null==e.rg?"<td colspan='4'>&nbsp</td>":"<td class='text-right>"+d+"</td><td>"+e.rg+"</td><td colspan='2'></td> ":"<td class='text-right'>"+s+"</td><td>"+e.cpf+"</td>",solicitante:e.cli_nome,frete:"Destinat&aacute;rio (Fob)",ve_nome:null==app.thisUser[0].ct_nome?app.thisUser[0].nome+" "+app.thisUser[0].sobrenome:app.thisUser[0].ct_nome+" "+app.thisUser[0].ct_snome,ve_email:app.thisUser[0].email,num_portas:e.portas,largura:e.largura,altura:e.altura,vao:25==e.tpi_id?"Dentro":"Fora",m2old:e.altura*e.largura*2,valor_total:app.N(p,2,","),observacoes:e.ocorrencias||"",infoPortas:null==e.portas?"":"<div class='row border border-dark text-center'><div class='col-2 border-right border-dark p-1'><span>Quantidade: "+e.portas+"</span></div><div class='col-2 border-right border-dark p-1'><span>Comprimento: "+e.largura+"</span></div>",infoPortas2:null==e.portas?"":"<div class='col-2 border-right border-dark p-1'><span>Altura: "+D+"</span></div><div class='col-2 border-right border-dark p-1'><span>Rolo: "+U+"</span></div><div class='col-2 border-right border-dark p-1'><span>"+(25==e.tpi_id?"Dentro":"Fora")+" do v&atilde;o</span></div><div class='col-2 p-1'><span>M2: "+b+"</span></div></div>",nome_empresa:t||"TECNOPORTAS"});console.log(U),console.log(e.altura),console.log(a.altura),console.log(a),app.geraHtmlByTemplate("pdf/orcamento-template.html",a,function(a){pdf.fromData(a,n).then(function(a){x="application/pdf;base64,"+a,app.savebase64AsPDF(P,w,a,"application/pdf",N)}).catch(function(a){console.log(a)})},v)})}}))})}var P=cordova.file.documentsDirectory,x=null,N=(Loader.mostrar(),null==r&&(r=!0),app.isPlatform("android")&&(P=cordova.file.externalDataDirectory),function(a){var t=P+w;console.log(t),a&&(t=a),window.setTimeout(function(){!0===o&&window.plugins.socialsharing.share(null,w,[t]),!0===r&&app.abrirDocumento(t,w),p&&(null==x&&console.log("PDF vazio?"),p(x,t)),Loader.remover()},100)});app.thisUser[0].foto?new Api("files?name="+app.thisUser[0].foto).download(function(a){a.error?t():t(a)}):t()}