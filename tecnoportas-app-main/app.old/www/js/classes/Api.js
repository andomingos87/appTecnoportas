"use strict";var Servidor="",thisUser=app.thisUser,getUrlParameter=app.getUrlParameter;function Api(o,r,e,t){function n(r,e,a){function n(o){a(ArquivoErros[o.code]),console.log(o)}var o=[window.TEMPORARY,window.PERSISTENT],t=0;0==l.isTemporario&&(t=1),window.requestFileSystem(o[t],5242880,function(o){o.root.getFile(r,{create:!0,exclusive:!1},e,n)},n)}var s,l=this,i=!0;l.url=o,l.sUrl=Servidor+l.url,0===l.url.indexOf("http")&&(l.sUrl=l.url),l.dados=r||{},l.isTemporario=!0,l.cacheHash=null,l.dados.retorno="json",thisUser&&(l.dados.serralheiro_id=thisUser[0].pessoa_id),l.cacheHash=app.MD5(l.sUrl+JSON.stringify(l.dados)),s=new VarGlobal(l.cacheHash),!1===e&&(i=!1);l.send=function(a){var n,o,r=!1,r=s.obterVar();!t&&r&&(s.salvarVar(null),r=!1),r?(console.log(l.url+" obtido Pelo Cache"),r=JSON.parse(r),a(r)):app.IsConectado()?(i&&Loader.mostrar(),n=!1,o=$.ajax({cache:!1,method:"POST",url:l.sUrl,data:l.dados,dataType:"json",success:function(o){s.salvarVar(JSON.stringify(o)),a(o),i&&Loader.remover()},error:function(o,r){var e;n||(e=(e=(e=lib.AjaxErros[o.status])||lib.AjaxErros[r])||o.responseText,a({error:e+"Motivo "+o.responseText})),i&&Loader.remover()}}),i&&Loader.onCancelar(function(){n=!0,o.abort()})):a({error:"net"})},l.download=function(s,r){function e(){var o;app.IsConectado()?((o=new XMLHttpRequest).responseType="blob",o.onprogress=function(o){o.lengthComputable&&r&&(r.value=o.loaded/o.total)},o.onerror=function(o){s({error:o.message}),console.log(o.message)},o.onabort=function(){s({error:"Download Abortado"}),console.log("Download abortado")},o.onload=function(e){n(a,function(o){var t=e.srcElement.response,r=o.nativeURL;r?o.createWriter(function(e){var a=0,n=t.size;e.onwrite=function(o){a<n?e.doWrite():(i.salvarLocal(r),s(r))},e.doWrite=function(){var o=Math.min(1048576,n-a),r=t.slice(a,a+o);a+=o,e.write(r)},e.doWrite()}):s(l.sUrl)},function(o){s({error:o}),console.log(o)})},o.open("POST",l.sUrl,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send("retorno=json")):s({error:"net"})}var a=getUrlParameter("name",l.url),i=new VarGlobal(l.url);i.obterLocal()?app.isFile(i.obterLocal(),function(o){o?s(i.obterLocal()):e()}):e()}}