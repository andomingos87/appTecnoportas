"use strict";var thisUser=app.thisUser;function Orcamento(t){function a(t){return"object"==typeof t&&!0}function e(t,e,o){var r=thisUser[0],o=o||{documentSize:"A4",type:"base64"},d=cordova.file.applicationDirectory+"www/images/centro.png",i=new Date,n=new Date(N.dt_cadastro.replace(/\s/,"T")),p=0,l=r.tel_num,c="J"==N.cli_tipo?"CNPJ":"CPF",s="J"==N.cli_tipo?"IE":"RG",u=app.N(app.C(N.altura,"*",N.largura),2,"."),m=app.N(N.largura)<8.5?.6:.9,a=[],_=app.N(app.C(N.altura,"-",m),3,".");i.setDate(n.getDate()+30);for(var l=l?(l=l.substring(l.length-4),"("+r.ddd+") "+r.tel_num.replace(l,"")+"-"+l):"",g=0;g<P.length;g++){var f,b,v,h=P[g],C=a.length+1,D=h.nome;switch(h.tipo){case"mto":f=h.mto_id,D="Motor "+h.nome;break;case"aut":f=h.aut_id;break;case"ptr":f=h.ptr_id,D="Pintura "+h.nome;break;default:f=h.id}v=0<=app.N(h.acrescimo)?"+":"-",b=0==app.N(h.preco_unitario)?app.C(h.preco_unitario,"+",h.acrescimo):app.C(app.C(h.preco_unitario,"*",app.C(h.acrescimo,"/",100)),v,h.preco_unitario),"-"==v&&(b*=-1),v=app.C(b,"/",h.quantidade),p=app.C(b,"+",p),a.push([C,h.codigo||f,D,h.medida,h.quantidade,app.N(v,2,","),app.N(b,2,",")])}var x={thead:{var:"colunas_tabela",dados:["Item","Código","Discrição das Mercadorias","Und","Qtd","Unitário","Total"]},tbody:{var:"dados_tabela",dados:a}};app.getImgFromApi(r.foto,function(t,a){a&&(d=t);a={orcamento_id:N.id,orcamento_data:app.formataData(n,!0),validade_orc:app.formataData(i),prev_entrega:app.formataData(i),logo_src:d,nome_fantasia:"J"==r.tipo?r.sobrenome:r.nome,razao_social:"J"==r.tipo?r.nome:r.nome+" "+r.sobrenome,texto_cnpj:!r.cnpj||"J"==r.tipo?"CNPJ:":"CPF:",cnpj:r.cnpj||"08.944.971/0001-00",texto_ie:r.ie?"J"==r.tipo?"IE:":"RG:":"",ie:r.ie||"",email:r.email,end_logradouro:r.logradouro,end_numero:r.numero,end_bairro:r.bairro,end_cep:r.cep,end_cidade:r.cidade,end_uf:r.uf,end_tel:l,cli_nome:"J"==N.cli_tipo?N.cli_nome:N.cli_nome+" "+N.cli_snome,cli_tel:"("+N.telefone_ddd+") "+N.telefone_num,cli_cidade:N.cidade,cli_uf:N.estado,cli_email:N.email,td_endereco:null==N.logradouro?"<td>&nbsp</td><td colspan='3'></td>":"<td class='text-right'>Endere&ccedil;o:</td><td colspan='3'>"+N.logradouro+"</td>",td_cel:null==N.celular?"<td></td><td></td>":"<td class='text-right'>Celular:</td><td>"+N.celular+"</td>",td_bairro:null==N.bairro?"<td class='text-right'>Cidade:</td><td class='text-uppercase'>"+N.cidade+" - "+N.estado+"</td><td></td><td></td>":"<td class='text-right'>Bairro:</td><td>"+N.bairro+"</td>",td_numImovel:null==N.num?"<td colspan='2'></td>":"  <td class='text-right'>N&uacute;mero Im&oacute;vel:</td><td>"+N.numero+"</td>",td_cep:null==N.cep?"<td colspan='2'></td>":"<td class='text-right'>CEP:</td><td>"+N.cep+"</td>",td_cpfRg:null==N.cpf?null==N.rg?"<td colspan='4'>&nbsp</td>":"<td class='text-right>"+s+"</td><td>"+N.rg+"</td><td colspan='2'></td> ":"<td class='text-right'>"+c+"</td><td>"+N.cpf+"</td>",solicitante:N.cli_nome,frete:"Destinat&aacute;rio (Fob)",ve_nome:null==r.ct_nome?r.nome+" "+r.sobrenome:r.ct_nome+" "+r.ct_snome,ve_email:r.email,num_portas:N.portas,largura:N.largura,altura:N.altura,vao:25==N.tpi_id?"Dentro":"Fora",m2old:N.altura*N.largura*2,valor_total:app.N(p,2,","),observacoes:N.ocorrencias||"",infoPortas:null==N.portas?"":"<div class='row border border-dark text-center'><div class='col-2 border-right border-dark p-1'><span>Quantidade: "+N.portas+"</span></div><div class='col-2 border-right border-dark p-1'><span>Comprimento: "+N.largura+"</span></div>",infoPortas2:null==N.portas?"":"<div class='col-2 border-right border-dark p-1'><span>Altura: "+_+"</span></div><div class='col-2 border-right border-dark p-1'><span>Rolo: "+m+"</span></div><div class='col-2 border-right border-dark p-1'><span>"+(25==N.tpi_id?"Dentro":"Fora")+" do v&atilde;o</span></div><div class='col-2 p-1'><span>M2: "+u+"</span></div></div>"};app.geraHtmlByTemplate("pdf/orcamento-template.html",a,function(t){pdf.fromData(t,o).then(function(t){pdfB64="application/pdf;base64,"+t,app.savebase64AsPDF(local,pdfTitulo,t,"application/pdf",e)}).catch(function(t){console.log(t)})},x)})}var o=this,N=null,P=null;o.getOrcamento=function(t,a){new Api("orcamentos/abrir",{orcamento_id:t}).send(function(t){t.error?app.Erro(t):(N=t.orcamento,P=t.produtos,"function"==typeof a&&a(t))})},o.getPDF=function(t){a(t)?e():o.getOrcamento(t,function(t){e()})},a(t)}